<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>survival analysis note (coursera)</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { overflow-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }
.ty-preferences .window-content { background-color: rgb(250, 250, 250); }
.ty-preferences .nav-group-item.active { color: white; background: rgb(153, 153, 153); }


</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><div class='md-toc' mdtype='toc'><p class="md-toc-content" role="list"><span role="listitem" class="md-toc-item md-toc-h1" data-ref="n2"><a class="md-toc-inner" style="cursor: pointer;" href="#notes-of-survival-analysis-in-r-for-public-health----coursera">Notes of Survival Analysis in R for Public Health -  Coursera</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n5"><a class="md-toc-inner" style="cursor: pointer;" href="#certifications">Certifications</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n14"><a class="md-toc-inner" style="cursor: pointer;" href="#week-1-the-kaplan-meier-plot-and-log-rank-test">Week 1. The Kaplan-Meier Plot and log-rank test</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n15"><a class="md-toc-inner" style="cursor: pointer;" href="#-1-key-concepts">1. Key Concepts</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n32"><a class="md-toc-inner" style="cursor: pointer;" href="#2-life-tables">2. Life Tables</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n93"><a class="md-toc-inner" style="cursor: pointer;" href="#3-kaplan-meier-table-and-plot">3. Kaplan-Meier Table and Plot</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n250"><a class="md-toc-inner" style="cursor: pointer;" href="#4-practice-in-r-run-a-km-plot-and-log-rank-test">4. Practice in R: Run a KM plot and log-rank test</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n296"><a class="md-toc-inner" style="cursor: pointer;" href="#week-2-the-simple-cox-model">Week 2. The simple Cox model</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n297"><a class="md-toc-inner" style="cursor: pointer;" href="#1-key-concepts">1. Key Concepts</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n327"><a class="md-toc-inner" style="cursor: pointer;" href="#2-practice-in-r-run-a-simple-cox-model">2. Practice in R: Run a simple Cox model</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n343"><a class="md-toc-inner" style="cursor: pointer;" href="#3-missing-data">3. Missing Data</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n388"><a class="md-toc-inner" style="cursor: pointer;" href="#week-3-the-multiple-cox-model">Week 3. The Multiple Cox Model</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n389"><a class="md-toc-inner" style="cursor: pointer;" href="#1-practice-in-r-run-multiple-cox-model">1. Practice in R: Run multiple Cox model</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n395"><a class="md-toc-inner" style="cursor: pointer;" href="#2-non-convergence-problem">2. Non-convergence Problem</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n429"><a class="md-toc-inner" style="cursor: pointer;" href="#3--alternative-to-cox--model">3.  Alternative to Cox  Model</a></span><span role="listitem" class="md-toc-item md-toc-h2" data-ref="n441"><a class="md-toc-inner" style="cursor: pointer;" href="#week-4-testing-model-assumptions-and-choosing-predictors">Week 4. Testing model assumptions and choosing predictors</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n442"><a class="md-toc-inner" style="cursor: pointer;" href="#1-checking-the-proportionality-assumption">1. Checking the proportionality assumption</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n498"><a class="md-toc-inner" style="cursor: pointer;" href="#2-residual-for-cox-model">2. Residual for Cox model</a></span><span role="listitem" class="md-toc-item md-toc-h3" data-ref="n528"><a class="md-toc-inner" style="cursor: pointer;" href="#3-model-selection-methods">3. Model selection methods</a></span></p></div><h1><a name="notes-of-survival-analysis-in-r-for-public-health----coursera" class="md-header-anchor"></a><span>Notes of Survival Analysis in R for Public Health -  Coursera</span></h1><p><span>Di Zhen</span></p><p><span>Feb, 2020</span></p><h2><a name="certifications" class="md-header-anchor"></a><span>Certifications</span></h2><ul><li><span>Certification for the course:</span></li></ul><p><a href='https://coursera.org/share/b3b835c7d607fb5675a4faf191d14c83' target='_blank' class='url'>https://coursera.org/share/b3b835c7d607fb5675a4faf191d14c83</a></p><ul><li><span>Certification for the specialization:</span></li></ul><p><a href='https://coursera.org/share/6b9da130ae9b966c9e2957bc214474ab' target='_blank' class='url'>https://coursera.org/share/6b9da130ae9b966c9e2957bc214474ab</a></p><h2><a name="week-1-the-kaplan-meier-plot-and-log-rank-test" class="md-header-anchor"></a><span>Week 1. The Kaplan-Meier Plot and log-rank test</span></h2><h3><a name="-1-key-concepts" class="md-header-anchor"></a><span>1. Key Concepts</span></h3><ul><li><p><span>The Kaplan-Meier plot:</span></p><ul><li><span>The Kaplan-Meier plot estimates the probability of surviving at least to any given time.</span></li><li><span>The Kaplan-Meier table and associated plot is the simplest (but not the only) way of estimating the survival time when you have drop-outs.</span></li></ul></li><li><p><span>Survival function</span></p></li><li><p><span>Log-rank test:</span></p><p><span>The associated test to compare the survival curves</span></p></li><li><p><span>Censored:</span></p><p><span>&#39;Censored&#39; means patients who are dropped out of the study and you don&#39;t know whether they&#39;re still alive after the dropped out.</span></p></li></ul><h3><a name="2-life-tables" class="md-header-anchor"></a><span>2. Life Tables</span></h3><ul><li><p><span>Life tables are used to measure the probability of death at a given age and the life expectancy at varying ages</span></p></li><li><p><span>Two types:</span></p><ul><li><p><span>Cohort or generational life tables</span></p><ul><li><span>take an actual set of people born at the same time and follow them up for their whole lives</span></li></ul></li><li><p><span>Current or period life tables</span></p><ul><li><span>take a hypothetical cohort of people born at the same time and uses the assumption that they are subject to the age-specific mortality rates of a region or country. </span></li><li><span>these rates are often calculated using census data as the base population and actual age-specific death rates during the census year (and typically also one year either side).</span></li></ul></li></ul></li><li><p><span>Used in cohort study</span></p><ul><li><span>a set or cohort of patients are enrolled at time zero and then followed up to see who gets the outcome of interest, such as death, and when they get it  </span></li></ul></li><li><p><span>Example:</span></p><ul><li><span>This assumes that everybody enters the study at the same time, t=0, and no one leaves it except by death. </span></li><li><span>And in this case, we ignore the more realistic case when people drop out or are “lost to follow-up” (censored)</span></li><li><span>The probability of surviving at least to time t=0 is 1, or 100% </span></li><li><span>However, the Kaplan-Meier table and associated plot is the simplest (but not the only) way of estimating the survival time when you have drop-outs.</span></li></ul></li></ul><figure><table><thead><tr><th><strong><span>Time (t)   in days</span></strong></th><th><strong><span>Number of   patients alive at time t</span></strong></th><th><strong><span>Number of   patients who died at time t</span></strong></th><th><strong><span>Probability   of survival past time t</span></strong></th></tr></thead><tbody><tr><td><span>0 (study  start)</span></td><td><span>100</span></td><td><span>0</span></td><td><span>1</span></td></tr><tr><td><span>1</span></td><td><span>100</span></td><td><span>2</span></td><td><span>0.98</span></td></tr><tr><td><span>2</span></td><td><span>98</span></td><td><span>??</span></td><td><span>??</span></td></tr><tr><td><span>3..</span></td><td><span>??</span></td><td><span>??</span></td><td><span>??</span></td></tr></tbody></table></figure><h3><a name="3-kaplan-meier-table-and-plot" class="md-header-anchor"></a><span>3. Kaplan-Meier Table and Plot</span></h3><figure><table><thead><tr><th><strong><span>Time (t)   in days</span></strong></th><th><strong><span>Event</span></strong></th></tr></thead><tbody><tr><td><span>0 (study  start)</span></td><td><span>8 patients  recruited</span></td></tr><tr><td><span>1</span></td><td><span>2 patients  die</span></td></tr><tr><td><span>4</span></td><td><span>1 patient  dies</span></td></tr><tr><td><span>5.</span></td><td><span>1 patient  dies</span></td></tr><tr><td><span>etc</span></td><td><span>etc</span></td></tr></tbody></table></figure><figure><table><thead><tr><th><strong><span>Time (t)   in days</span></strong></th><th><strong><span>Number of   patients alive at time t</span></strong></th><th><strong><span>Number of   patients who died at time t</span></strong></th><th><strong><span>Proportion   of patients surviving past time t</span></strong></th><th><strong><span>Probability   of survival past time t</span></strong></th></tr></thead><tbody><tr><td><span>0 (study  start)</span></td><td><span>8</span></td><td><span>0</span></td><td><span>(8-0)/8=1</span></td><td><span>1</span></td></tr><tr><td><span>1</span></td><td><span>8</span></td><td><span>2</span></td><td><span>(8-2)/8=0.75</span></td><td><span>1 * 0.75 =  0.75</span></td></tr><tr><td><span>4</span></td><td><span>6</span></td><td><span>1</span></td><td><span>(6-1)/6=0.83</span></td><td><span>0.75*0.83  = 0.623</span></td></tr><tr><td><span>5</span></td><td><span>5</span></td><td><span>1</span></td><td><span>(5-1)/5=0.8</span></td><td><span>0.623*0.8  = 0.498</span></td></tr></tbody></table></figure><ul><li><p><span>To construct a Kaplan-Meier table (above)</span></p><ul><li><span>The Kaplan-Meier method can be used to estimate this curve from the observed survival times without the assumption of an underlying probability distribution.   </span></li><li><span>Basic idea: the probability of surviving past day </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span> is simply the probability of surviving past day </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.839ex" height="2.11ex" viewBox="0 -755.9 2083.4 908.7" role="img" focusable="false" style="vertical-align: -0.355ex;"><defs><path stroke-width="0" id="E2-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="0" id="E2-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="0" id="E2-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E2-MJMATHI-74" x="0" y="0"></use><use xlink:href="#E2-MJMAIN-2212" x="583" y="0"></use><use xlink:href="#E2-MJMAIN-31" x="1583" y="0"></use></g></svg></span><script type="math/tex">t-1</script><span> times the proportion of patients that survive on day </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span>.</span></li></ul></li></ul><p><img src="C:\Users\dizhe\AppData\Roaming\Typora\typora-user-images\image-20200318162859691.png" referrerpolicy="no-referrer" alt="image-20200318162859691"></p><ul><li><p><span>Survival curve for Kaplan-Meier example</span></p><ul><li><span>The plot of the survival function versus time is called the survival curve.</span></li><li><span>The “steps” involve a horizontal line followed by a vertical line, because the probability is assumed to be the same until the next death occurs</span></li></ul></li></ul><figure><table><thead><tr><th><strong><span>Time (t)   in days</span></strong></th><th><strong><span>Event</span></strong></th></tr></thead><tbody><tr><td><span>0 (study  start)</span></td><td><span>8 patients  recruited</span></td></tr><tr><td><span>1</span></td><td><span>2 patients  die</span></td></tr><tr><td><span>4</span></td><td><span>1 patient  dies</span></td></tr><tr><td><span>5.</span></td><td><span>1 patient  dies</span></td></tr><tr><td><span>6</span></td><td><span>1 patient  drop out</span></td></tr><tr><td><span>9</span></td><td><span>1 patient  dies and 1 drops out</span></td></tr><tr><td><span>22</span></td><td><span>1 patient  dies</span></td></tr></tbody></table></figure><figure><table><thead><tr><th><strong><span>Time   (t) in days</span></strong></th><th><strong><span>Number   of patients alive at time t</span></strong></th><th><strong><span>Number   of patients who died at time t</span></strong></th><th><strong><span>Proportion   of patients surviving past time t</span></strong></th><th><strong><span>Probability   of survival past time t</span></strong></th></tr></thead><tbody><tr><td><span>0  (study start)</span></td><td><span>8</span></td><td><span>0</span></td><td><span>1</span></td><td><span>1</span></td></tr><tr><td><span>1</span></td><td><span>8</span></td><td><span>2</span></td><td><span>0.75</span></td><td><span>0.75</span></td></tr><tr><td><span>4</span></td><td><span>6</span></td><td><span>1</span></td><td><span>0.83</span></td><td><span>0.75*0.83  = 0.623</span></td></tr><tr><td><span>5</span></td><td><span>5</span></td><td><span>1</span></td><td><span>0.8</span></td><td><span>0.623*0.8  = 0.498</span></td></tr><tr><td><span>6+</span></td><td><span>4</span></td><td><span>0</span></td><td><span>(4-0)/4 = 1</span></td><td><span>0.498*1  = 0.498</span></td></tr><tr><td><span>9</span></td><td><span>3</span></td><td><span>1</span></td><td><span>(3-1)/3=0.667</span></td><td><span>0.498*0.667  = 0.332</span></td></tr><tr><td><span>9+</span></td><td><span>2</span></td><td><span>0</span></td><td><span>(2-0)/2 = 1</span></td><td><span>0.332*1  = 0.332</span></td></tr><tr><td><span>22</span></td><td><span>1</span></td><td><span>1</span></td><td><span>(1-1)/1 = 0</span></td><td><span>0.332*0 = 0</span></td></tr></tbody></table></figure><ul><li><p><span>Censored patients</span></p><ul><li><span>classified neither as &#39;survived&#39; nor as &#39;died&#39; on any given day</span></li><li><span>Then we add a new line, mark it with a little &#39;+&#39; right after the time count and denote the censored patient(s) by taking them off the count of patients alive at time t.</span></li></ul></li></ul><p><img src="C:\Users\dizhe\AppData\Roaming\Typora\typora-user-images\image-20200318163906541.png" referrerpolicy="no-referrer" alt="image-20200318163906541"></p><h3><a name="4-practice-in-r-run-a-km-plot-and-log-rank-test" class="md-header-anchor"></a><span>4. Practice in R: Run a KM plot and log-rank test</span></h3><p><span>Download the data from </span><a href='https://drive.google.com/file/d/1BY3vOXDQWSlRtK2mKhAtRwIR-vzoDm-4/view'><span>here</span></a><span>.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">install.packages</span>(<span class="cm-string">"survival"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">survival</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">ggplot2</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Import data</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">g</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">read.csv</span>(<span class="cm-variable">file</span> <span class="cm-operator">=</span> <span class="cm-string">"simulated HF mort data for GMPH (1K) final.csv"</span>, <span class="cm-variable">header</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span>, <span class="cm-variable">sep</span><span class="cm-operator">=</span><span class="cm-string">','</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Variables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">gender</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">as.factor</span>(<span class="cm-variable">g</span>[,<span class="cm-string">"gender"</span>]) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fu_time</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">g</span>[,<span class="cm-string">"fu_time"</span>] </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">death</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">g</span>[,<span class="cm-string">"death"</span>] </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Run an overall Kaplan-Meier plot</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">km_fit</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">survfit</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot</span>(<span class="cm-variable">km_fit</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 295px;"></div><div class="CodeMirror-gutters" style="display: none; height: 295px;"></div></div></div></pre><ul><li><span>“Survfit” fits a simple survival model that depends only on gender in terms of predictors: in this case there aren’t any predictors, so the model just has the intercept, denoted by “1”. The two arguments used by “Surv” are the follow-up time for each patient and whether they died</span></li><li><span>The survfit() function produces the Kaplan-Meier estimates of the probability of survival over time that are used by “plot” to produce the Kaplan-Meier curve above</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Estimate</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">km_fit</span>, <span class="cm-variable">times</span> <span class="cm-operator">=</span> <span class="cm-variable">c</span>(<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">7</span>,<span class="cm-number">30</span>,<span class="cm-number">60</span>,<span class="cm-number">90</span><span class="cm-operator">*</span>(<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-number">10</span>))) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><span>The “times” argument gives us control over what time periods we want to see. </span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Extend this by splitting the curve by gender</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">km_gender_fit</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">survfit</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">gender</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot</span>(<span class="cm-variable">km_gender_fit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Run a logrank test</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">survdiff</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">gender</span>, <span class="cm-variable">rho</span><span class="cm-operator">=</span><span class="cm-number">0</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ul><li><span>With rho = 0, which is the default, it yields the log-rank or Mantel-Haenszel test</span></li><li><span>The log-rank test compares the survival time by gender. We can know both genders will have similar survival rate or not based on p-value.</span></li><li><span>The </span><strong><span>log-rank test</span></strong><span> is based on a comparison of the observed numbers of deaths and the numbers of deaths expected if in fact there were no difference in the probability of death between the groups (genders in this case) and uses a chi-squared test.</span></li></ul><figure><table><thead><tr><th>&nbsp;</th><th><span>N</span></th><th><span>Observed</span></th><th><span>Expected</span></th><th><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.182ex" height="2.816ex" viewBox="0 -908.4 5245 1212.6" role="img" focusable="false" style="vertical-align: -0.706ex;"><defs><path stroke-width="0" id="E4-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E4-MJMATHI-4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path stroke-width="0" id="E4-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="0" id="E4-MJMATHI-45" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path><path stroke-width="0" id="E4-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="0" id="E4-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="0" id="E4-MJMAIN-2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E4-MJMAIN-28" x="0" y="0"></use><use xlink:href="#E4-MJMATHI-4F" x="389" y="0"></use><use xlink:href="#E4-MJMAIN-2212" x="1374" y="0"></use><use xlink:href="#E4-MJMATHI-45" x="2374" y="0"></use><g transform="translate(3138,0)"><use xlink:href="#E4-MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E4-MJMAIN-32" x="550" y="513"></use></g><use xlink:href="#E4-MJMAIN-2F" x="3980" y="0"></use><use xlink:href="#E4-MJMATHI-45" x="4480" y="0"></use></g></svg></span><script type="math/tex">(O-E)^2/E</script></th><th><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.194ex" height="2.816ex" viewBox="0 -908.4 5250 1212.6" role="img" focusable="false" style="vertical-align: -0.706ex;"><defs><path stroke-width="0" id="E5-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E5-MJMATHI-4F" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path stroke-width="0" id="E5-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="0" id="E5-MJMATHI-45" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path><path stroke-width="0" id="E5-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="0" id="E5-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="0" id="E5-MJMAIN-2F" d="M423 750Q432 750 438 744T444 730Q444 725 271 248T92 -240Q85 -250 75 -250Q68 -250 62 -245T56 -231Q56 -221 230 257T407 740Q411 750 423 750Z"></path><path stroke-width="0" id="E5-MJMATHI-56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E5-MJMAIN-28" x="0" y="0"></use><use xlink:href="#E5-MJMATHI-4F" x="389" y="0"></use><use xlink:href="#E5-MJMAIN-2212" x="1374" y="0"></use><use xlink:href="#E5-MJMATHI-45" x="2374" y="0"></use><g transform="translate(3138,0)"><use xlink:href="#E5-MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#E5-MJMAIN-32" x="550" y="513"></use></g><use xlink:href="#E5-MJMAIN-2F" x="3980" y="0"></use><use xlink:href="#E5-MJMATHI-56" x="4480" y="0"></use></g></svg></span><script type="math/tex">(O-E)^2/V</script></th></tr></thead><tbody><tr><td><span>gender=1</span></td><td><span>548</span></td><td><span>268</span></td><td><span>271</span></td><td><span>0.0365</span></td><td><span>0.082</span></td></tr><tr><td><span>gender=2</span></td><td><span>452</span></td><td><span>224</span></td><td><span>221</span></td><td><span>0.0448</span></td><td><span>0.082</span></td></tr></tbody></table></figure><p><span>Chisq=0.1    on 1 degrees of freedom, p=0.8                                       </span></p><ul><li><span>Interpretation: The 548 male patients (gender = 1) had 268 observed deaths, but you would expect 271 under the null hypothesis of no difference in survival times by gender group. And the female group also had roughly the same number of deaths as expected under the null, which confirms that there is no difference (p = 0.8) of survival after hospital admission between two genders.</span></li></ul><h2><a name="week-2-the-simple-cox-model" class="md-header-anchor"></a><span>Week 2. The simple Cox model</span></h2><h3><a name="1-key-concepts" class="md-header-anchor"></a><span>1. Key Concepts</span></h3><ul><li><p><span>Cox proportional hazards model:</span></p><ul><li><span>Cox proportional hazards model can be used to compare the survival of multiple groups of patients at the same time.</span></li><li><span>The hazards are assumed by the model to be proportional</span></li><li><span>Hazard: The risk of death at a given moment in time</span></li><li><span>Hazard function/rate: The way the hazard changes overtime</span></li><li><span>Hazard ratio</span></li></ul></li><li><p><span>The hazard function</span></p><p><a href='https://data.princeton.edu/wws509/notes/c7s1' target='_blank' class='url'>https://data.princeton.edu/wws509/notes/c7s1</a><span> </span></p><ul><li><span>The hazard function </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.983ex" height="2.577ex" viewBox="0 -806.1 1715 1109.7" role="img" focusable="false" style="vertical-align: -0.705ex;"><defs><path stroke-width="0" id="E6-MJMATHI-68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path><path stroke-width="0" id="E6-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="0" id="E6-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="0" id="E6-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E6-MJMATHI-68" x="0" y="0"></use><use xlink:href="#E6-MJMAIN-28" x="576" y="0"></use><use xlink:href="#E6-MJMATHI-74" x="965" y="0"></use><use xlink:href="#E6-MJMAIN-29" x="1326" y="0"></use></g></svg></span><script type="math/tex">h(t)</script><span> is the probability of the event happening at time </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span>, given that it has not yet happened, or the probability of dying at time </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span> having survived up to time </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span>.</span></li></ul></li><li><p><span>Risk set</span></p><ul><li><span>The number of patients that are subjected to the risk change over time as people die or drop out</span></li><li><span>The risk set at time </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span> is defined as the set of patients at time </span><span class="MathJax_SVG" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.838ex" height="1.877ex" viewBox="0 -705.6 361 808.1" role="img" focusable="false" style="vertical-align: -0.238ex;"><defs><path stroke-width="0" id="E11-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#E11-MJMATHI-74" x="0" y="0"></use></g></svg></span><script type="math/tex">t</script><span> that are at risk of experiencing the event</span></li><li><span>Survival analysis consists of a family of methods, and one way that they differ is in their handling of drop-outs and other issues when they define the risk set.</span></li></ul></li></ul><h3><a name="2-practice-in-r-run-a-simple-cox-model" class="md-header-anchor"></a><span>2. Practice in R: Run a simple Cox model</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">install.packages</span>(<span class="cm-string">"survminer"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">library</span>(<span class="cm-variable">survminer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># variables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ethnicgroup</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">factor</span>(<span class="cm-variable">g</span>[,<span class="cm-string">"ethnicgroup"</span>]) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fu_time</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">g</span>[,<span class="cm-string">"fu_time"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">death</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">g</span>[,<span class="cm-string">"death"</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Run the Cox model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">ethnicgroup</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">cox</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 204px;"></div><div class="CodeMirror-gutters" style="display: none; height: 204px;"></div></div></div></pre><ul><li><span>Notice the missing data</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">levels</span>(<span class="cm-variable">ethnicgroup</span>)<span class="cm-operator cm-arrow">&lt;-</span><span class="cm-variable">c</span>(<span class="cm-variable">levels</span>(<span class="cm-variable">ethnicgroup</span>),<span class="cm-string">"8"</span>) <span class="cm-comment"># add level 8 to the factor</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ethnicgroup</span>[<span class="cm-variable">is.na</span>(<span class="cm-variable">ethnicgroup</span>)] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-string">"8"</span> <span class="cm-comment"># Change NA to "None"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">ethnicgroup</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">cox</span>) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ul><li><p><span>Check the standard errors</span></p></li><li><p><span>The hazard for one variable is the hazard ratio (exp(coefficient)) times reference category. </span></p><ul><li><span>If the hazard is above 1, it means that group has an increased risk compared with reference category. For example, if the hazard is 1.15, it is 15% higher than reference category.</span></li></ul></li><li><p><span>If the p-value is small, there is a statistically significant difference in favor of these patients compared with the reference category.</span></p></li></ul><h3><a name="3-missing-data" class="md-header-anchor"></a><span>3. Missing Data</span></h3><ul><li><p><span>Three types</span></p><ul><li><p><span>&#39;missing completely at random&#39; (MCAR) </span></p><ul><li><span>One patient is just as likely to have missing values as any other patient: males just as likely as females, older patients just as likely as younger ones etc.</span></li></ul></li><li><p><span>&#39;missing at random&#39; (MAR)</span></p><ul><li><span>Missingness can be explained by other variables for which there is full information</span></li></ul></li><li><p><span>&#39;missing not at random&#39; (MNAR) </span></p><ul><li><span>when the missingness is specifically related to what’s missing and so the probability of the value being missing depends on unobserved variables, i.e., variables not in your data set. This is generally the most problematic type.</span></li></ul></li></ul></li><li><p><span>Problem: </span></p><ul><li><span>If the data are MCAR, this will produce unbiased estimates as long as the sample size is still sufficiently large. </span></li><li><span>If the data are MAR or MNAR, the estimates will be biased.  </span></li></ul></li><li><p><span>Solution:</span></p><ul><li><p><span>Mean substitution (or mean imputation):</span></p><ul><li><span>This has the advantage of not changing the overall mean for that variable. However, it artificially decreases the estimated variation. It also makes it difficult to detect correlations between the imputed variable and other variables. Hence mean substitution always gives biased results and is not recommended.</span></li></ul></li><li><p><span>Multiple imputation:</span></p><ul><li><span>Missing variables are assumed to be MAR (or MCAR) and are imputed by drawing from a distribution. This is done multiple times and yields multiple different completed datasets. Each of these datasets is analyzed, and the results are combined into a single overall result. Multiple imputation has been shown to yield unbiased results for MAR or MCAR data. </span></li></ul></li><li><p><span>Maximum likelihood:</span></p><ul><li><span>This approach also gives unbiased results for MAR (or MCAR) data. Data are assumed to be normally distributed with a certain (multivariate) mean and variance. </span></li></ul></li></ul></li></ul><h2><a name="week-3-the-multiple-cox-model" class="md-header-anchor"></a><span>Week 3. The Multiple Cox Model</span></h2><h3><a name="1-practice-in-r-run-multiple-cox-model" class="md-header-anchor"></a><span>1. Practice in R: Run multiple Cox model</span></h3><ul><li><span>Each association is adjusted for the other predictors in the model</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span> <span class="cm-operator">+</span> <span class="cm-variable">gender</span> <span class="cm-operator">+</span> <span class="cm-variable">copd</span> <span class="cm-operator">+</span> <span class="cm-variable">prior_dnas</span> <span class="cm-operator">+</span> <span class="cm-variable">ethnicgroup</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">cox</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><h3><a name="2-non-convergence-problem" class="md-header-anchor"></a><span>2. Non-convergence Problem</span></h3><ul><li><p><span>Problem:</span></p><ul><li><span>Very high standard errors</span></li><li><span>Infinitely wide CI</span></li></ul></li><li><p><span>Reason:</span></p><ul><li><span>Extremely data in reference category chose by R by default</span></li></ul></li><li><p><span>Solution:</span></p><ol start='' ><li><span>Change the reference category</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">relevel</span>(<span class="cm-variable">quintile</span>, <span class="cm-variable">ref</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>) <span class="cm-comment"># quintile 1 as the ref cat</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span> <span class="cm-operator">+</span> <span class="cm-variable">gender</span> <span class="cm-operator">+</span> <span class="cm-variable">copd</span> <span class="cm-operator">+</span> <span class="cm-variable">quintile</span> <span class="cm-operator">+</span> <span class="cm-variable">ethnicgroup</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">cox</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><ol start='2' ><li><p><span>Combine categories</span></p><p><span>Not always a good idea, because two group are different.</span></p></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile_5groups</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">g</span>[,<span class="cm-string">'quintile'</span>] <span class="cm-comment"># best start with the original data set, not from "quintile"</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile_5groups</span>[<span class="cm-variable">quintile_5groups</span><span class="cm-operator">==</span><span class="cm-number">0</span>] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-number">5</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile_5groups</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">factor</span>(<span class="cm-variable">quintile_5groups</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">table</span>(<span class="cm-variable">quintile_5groups</span>, <span class="cm-variable">exclude</span><span class="cm-operator">=</span><span class="cm-atom">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span> <span class="cm-operator">+</span> <span class="cm-variable">gender</span> <span class="cm-operator">+</span> <span class="cm-variable">copd</span> <span class="cm-operator">+</span> <span class="cm-variable">quintile</span> <span class="cm-operator">+</span> <span class="cm-variable">ethnicgroup</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">cox</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 204px;"></div><div class="CodeMirror-gutters" style="display: none; height: 204px;"></div></div></div></pre><ol start='3' ><li><span>Exclude the patients</span></li></ol><p><span>if combining categories doesn’t make sense and there are only a few patients in the problematic category</span></p><ol start='4' ><li><span>Drop the offending variable</span></li></ol><p><span>if combining categories doesn’t make sense and if there are too many few patients in the problematic category for us to be comfortable dropping them all.</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile_5groups</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">g</span>[,<span class="cm-string">'quintile'</span>] </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile_5groups</span>[<span class="cm-variable">quintile_5groups</span><span class="cm-operator">==</span><span class="cm-number">0</span>] <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-atom">NA</span> <span class="cm-comment"># set the zeroes to missing </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quintile_5groups</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">factor</span>(<span class="cm-variable">quintile_5groups</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">table</span>(<span class="cm-variable">quintile_5groups</span>, <span class="cm-variable">exclude</span><span class="cm-operator">=</span><span class="cm-atom">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span> <span class="cm-operator">+</span> <span class="cm-variable">gender</span> <span class="cm-operator">+</span> <span class="cm-variable">copd</span> <span class="cm-operator">+</span> <span class="cm-variable">ethnicgroup</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">summary</span>(<span class="cm-variable">cox</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 204px;"></div><div class="CodeMirror-gutters" style="display: none; height: 204px;"></div></div></div></pre></li></ul><h3><a name="3--alternative-to-cox--model" class="md-header-anchor"></a><span>3.  Alternative to Cox  Model</span></h3><ul><li><span>Cox doesn’t care about the distribution of survival times or what the hazard function looks like. This is why it’s called “semi-parametric”: it has some parameters – those of the predictors – but it has no parameters to describe the hazard function for patients with a value of zero for the predictors. The Cox model was developed to look at the effect of covariates on the hazard function rather than to estimate survival times.</span></li><li><span>The Kaplan-Meier estimates are examples of non-parametric survival analysis</span></li><li><span>However, making assumptions about the shape of the hazard function – adding parameters to the model to describe the shape, making the model “fully parametric” – can lead to better prediction. </span></li><li><span>There are several such fully parametric models such as Weibull, exponential, log-normal, and log-logistic models, where hazard function has to be specified. </span></li><li><span>Survival analysis can also be run in a Bayesian framework.</span></li></ul><h2><a name="week-4-testing-model-assumptions-and-choosing-predictors" class="md-header-anchor"></a><span>Week 4. Testing model assumptions and choosing predictors</span></h2><h3><a name="1-checking-the-proportionality-assumption" class="md-header-anchor"></a><span>1. Checking the proportionality assumption</span></h3><ul><li><p><span>An informal visual check:</span></p><ul><li><span>When you have a predictor with few categories, you can also use the Kaplan-Meier plot. The lines give the survival probability for each gender at each time point. </span></li><li><span>If the predictor satisfies the proportional hazard assumption, then the graph of the survival function versus the survival time should yield parallel curves. </span></li><li><span>This method does not work well for continuous predictors or categorical ones with many levels because the graph becomes too “cluttered”.</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">km_fit</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">survfit</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">gender</span>) </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">autoplot</span>(<span class="cm-variable">km_fit</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot</span>(<span class="cm-variable">km_fit</span>, <span class="cm-variable">xlab</span> <span class="cm-operator">=</span> <span class="cm-string">"time"</span>, <span class="cm-variable">ylab</span> <span class="cm-operator">=</span> <span class="cm-string">"Survival probability"</span>) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre></li><li><p><span>Using other types of residuals in Cox model</span></p><ul><li><p><span>Deviance residuals </span></p><ul><li><span>Deviance residuals are transformations of martingale residuals and help you look for outliers or influential data points. You can either examine the influence of each data point on the coefficients or plot the distribution of the residuals against the covariate.</span></li><li><span>Specifying the argument type = “dfbeta” plots the estimated changes in the regression coefficients on deleting each observation (patient) in turn.</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res.cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span>) </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggcoxdiagnostics</span>(<span class="cm-variable">res.cox</span>, <span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-string">"dfbeta"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">linear.predictions</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>, <span class="cm-variable">ggtheme</span> <span class="cm-operator">=</span> <span class="cm-variable">theme_bw</span>())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre><ul><li><p><span>It’s also possible to check outliers by visualizing the deviance residuals, which are normalized transformations of the martingale residual and should be roughly symmetrically distributed about zero with a standard deviation of 1.</span></p><ul><li><span>Positive values correspond to individuals that “died too soon” compared with expected survival times.</span></li><li><span>Negative values correspond to individuals that “lived too long” compared with expected survival times.</span></li><li><span>Very large or small values are outliers, which are poorly predicted by the model.</span></li></ul></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">res.cox</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span>) </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggcoxdiagnostics</span>(<span class="cm-variable">res.cox</span>, <span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-string">"deviance"</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">linear.predictions</span> <span class="cm-operator">=</span> <span class="cm-variable">FALSE</span>, <span class="cm-variable">ggtheme</span> <span class="cm-operator">=</span> <span class="cm-variable">theme_bw</span>()) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 91px;"></div><div class="CodeMirror-gutters" style="display: none; height: 91px;"></div></div></div></pre></li><li><p><span>Martingale residual</span></p><ul><li><p><span>Test whether any continuous variables that assumed to have a linear relation with the outcome actually do have a linear relation</span></p></li><li><p><span>Martingale residuals may present any value between minus infinity and 1, and have a mean of zero</span></p><ul><li><span>Martingale residuals near 1 represent individuals that “died too soon”</span></li><li><span>Large negative values correspond to individuals that “lived too long”</span></li></ul></li></ul></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ggcoxfunctional</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">age</span> <span class="cm-operator">+</span> <span class="cm-variable">log</span>(<span class="cm-variable">age</span>) <span class="cm-operator">+</span> <span class="cm-variable">sqrt</span>(<span class="cm-variable">age</span>)) </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre></li><li><p><span>The function cox.zph() correlates for each predictor the corresponding set of scaled Schoenfeld residuals with time</span></p><ul><li><span>If p-value is high, assumption is met.</span></li><li><span>If the line is pretty flat, meaning that the effect of gender changes little during the follow-up period. That’s good news.</span></li></ul></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="R"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="r"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fit</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">coxph</span>(<span class="cm-variable">Surv</span>(<span class="cm-variable">fu_time</span>, <span class="cm-variable">death</span>) <span class="cm-operator">~</span> <span class="cm-variable">gender</span>) <span class="cm-comment"># fit the desired model</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">temp</span> <span class="cm-operator cm-arrow">&lt;-</span> <span class="cm-variable">cox.zph</span>(<span class="cm-variable">fit</span>)<span class="cm-comment"># apply the cox.zph function to the desired model</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">print</span>(<span class="cm-variable">temp</span>) <span class="cm-comment"># display the results</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">plot</span>(<span class="cm-variable">temp</span>) <span class="cm-comment"># plot the curves</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 136px;"></div><div class="CodeMirror-gutters" style="display: none; height: 136px;"></div></div></div></pre><h3><a name="2-residual-for-cox-model" class="md-header-anchor"></a><span>2. Residual for Cox model</span></h3><ul><li><p><span>Schoenfeld Residuals</span></p><ul><li><span>Schoenfeld Residuals test whether two hazard functions are parallel, or &quot;proportional&quot;.</span></li><li><span>e.g. If residuals for gender do not correlate the follow-up time, i.e. independent of time, the assumption is valid.</span></li></ul></li><li><p><span>Martingale Residuals</span></p><ul><li><p><span>Martingale Residuals test whether a continuous predictor, such as age, has a linear relationship with the outcome.</span></p></li><li><p><span>Martingale residuals may present any value between minus infinity and 1, and have a mean of zero</span></p><ul><li><span>Martingale residuals near 1 represent individuals that “died too soon”</span></li><li><span>Large negative values correspond to individuals that “lived too long”</span></li></ul></li></ul></li><li><p><span>Deviance Residuals</span></p><ul><li><span>Deviance Residuals spot influential points</span></li><li><span>Influential points: those are unusual enough to have a big influence on the model&#39;s hazard ratio</span></li><li><span>In a Cox model, one unusual point can dramatically affect the size of one or more hazard ratio.</span></li></ul></li></ul><h3><a name="3-model-selection-methods" class="md-header-anchor"></a><span>3. Model selection methods</span></h3><ul><li><p><span>forwards selection - awful</span></p></li><li><p><span>stepwise selection - awful</span></p></li><li><p><span>backwards elimination - fine</span></p><ol start='' ><li><p><span>Fit the model containing all your chosen predictors – either all your a priori ones or all your available ones (if your data set isn’t too large)</span></p></li><li><p><span>Store all the coefficients from that model</span></p></li><li><p><span>Remove in one go all predictors whose p value is above the preset threshold, typically the usual 0.05 (in a variant of this, you remove the predictor with the highest p value and refit the model, repeating steps until all the predictors have p values above the chosen threshold)</span></p></li><li><p><span>Compare the coefficients for the remaining predictors with their coefficients from the original model</span></p><ul><li><span>until the coefficients haven’t changed much from the original model</span></li><li><span>If a predictor&#39;s coefficient has changed noticeably, find the variable(s) that&#39;s been removed that are correlated with this affected predictor</span></li><li><span>Anything less than 0.05, e.g. a change from HR=1.30 to HR=1.34, is not big enough</span></li></ul></li></ol></li><li><p><span>using priori knowledge - always good</span></p></li></ul><p>&nbsp;</p></div>
</body>
</html>